<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ú©ØªØ±ÛŒÙ†Ú¯ Ø§ÙˆØ³ØªØ§ â€” Ù…Ù†Ùˆ</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{/*bg:#0f1724;--card:#0b1226;--muted:#9aa6b2;--accent:#22c55e;--accent2:#06b6d4;--text:#e6eef6*/}
*{box-sizing:border-box}
html,body{margin:0;padding:0;height:100%;font-family:'Vazirmatn',system-ui;background:linear-gradient(160deg,#071029 0%, #0b1226 60%);color:var(--text)}
.container{max-width:1100px;margin:14px auto;padding:16px}
header{display:flex;align-items:center;justify-content:space-between;gap:12px;background:rgba(255,255,255,0.02);padding:12px;border-radius:12px}
h1{margin:0;font-size:20px}
.meta{color:var(--muted);font-size:13px}
.controls{display:flex;gap:8px;align-items:center;margin-top:12px;flex-wrap:wrap}
.search{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);min-width:220px}
.layout{display:grid;grid-template-columns:1fr 360px;gap:16px;margin-top:16px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
.card{background:linear-gradient(180deg,#0f1724,#071122);border:1px solid rgba(255,255,255,0.04);padding:12px;border-radius:12px;display:flex;flex-direction:column;gap:8px}
.food-img{width:100%;height:160px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,0.03)}
.row{display:flex;align-items:center;justify-content:space-between}
.price{font-weight:700}
.btn{border:0;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700}
.btn-add{background:var(--accent);color:#052410}
.aside{background:linear-gradient(180deg,#071226,#071022);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);height:max-content;position:sticky;top:16px}
label{display:block;font-size:13px;color:var(--muted);margin-top:8px}
input[type="text"]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text)}
.cart-list{margin-top:12px;display:flex;flex-direction:column;gap:8px;max-height:320px;overflow:auto;padding-right:6px}
.cart-item{display:flex;justify-content:space-between;gap:8px;padding:10px;background:linear-gradient(180deg,#071826,#05121a);border-radius:8px;border:1px solid rgba(255,255,255,0.02)}
.checkout{margin-top:12px;background:var(--accent2);color:#001018;padding:12px;border-radius:10px;border:0;cursor:pointer;width:100%;font-weight:800}
.footer{text-align:center;color:var(--muted);font-size:13px;margin-top:18px}
@media(max-width:960px){.layout{grid-template-columns:1fr}.aside{position:static}}
.small{color:var(--muted);font-size:13px}
</style>
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
const supabaseUrl = "https://btwyxylbtwjvahciqwiq.supabase.co";
const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ0d3l4eWxidHdqdmFoY2lxd2lxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MDQzMzQsImV4cCI6MjA3Mjk4MDMzNH0.yR3kq5iv4XYdEOYXpkKtBKhUb8hvPCs3XeykRmwLDvE";
const supabase = createClient(supabaseUrl, supabaseAnonKey);

// Ù…Ù†ÙˆÛŒ Ú©Ø§Ù…Ù„ (Ø§Ø² ØªØµÙˆÛŒØ± Ø´Ù…Ø§)
const foods = [
  {id:1,name:"Ú†Ù„Ùˆ Ú©ÙˆØ¨ÛŒØ¯Ù‡",price:320000,img:"https://i.ibb.co/dBtTQ7w/kabab.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:2,name:"Ú†Ù„Ùˆ Ø¬ÙˆØ¬Ù‡",price:220000,img:"https://i.ibb.co/g6G9W2p/joojeh.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:3,name:"Ú†Ù„Ùˆ Ø¬ÙˆØ¬Ù‡ Ø¨Ø§ Ø³Ø³ Ù…Ø®ØµÙˆØµ",price:340000,img:"https://i.imgur.com/2X8Zz7K.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:4,name:"Ú†Ù„Ùˆ Ú¯ÙˆØ´Øª",price:340000,img:"https://i.imgur.com/8V6kK6j.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:5,name:"Ú†Ù„Ùˆ Ù…Ø±Øº",price:180000,img:"https://i.imgur.com/o8QZ7vO.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:6,name:"Ú†Ù„Ùˆ Ù…ÛŒÚ©Ø³",price:280000,img:"https://i.imgur.com/TZxqk2H.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:7,name:"Ú†Ù„Ùˆ ÙˆØ²ÛŒØ±ÛŒ",price:350000,img:"https://i.imgur.com/6hQk2s9.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:8,name:"Ø®ÙˆØ±Ø§Ú© Ø¬ÙˆØ¬Ù‡",price:150000,img:"https://i.imgur.com/1X5YFfU.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:9,name:"Ú†Ù„Ùˆ Ú©Ø±Ù‡",price:70000,img:"https://i.imgur.com/9QpQX2L.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:10,name:"Ú†Ù„Ùˆ Ø¨Ø®ØªÛŒØ§Ø±ÛŒ",price:280000,img:"https://i.imgur.com/0qRzltX.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:11,name:"Ú†Ù„Ùˆ Ø¨Ø±Ú¯",price:280000,img:"https://i.imgur.com/3Qm1K4B.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:12,name:"Ú†Ù„Ùˆ Ø³Ù„Ø·Ø§Ù†ÛŒ",price:350000,img:"https://i.imgur.com/h5JXgUv.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:13,name:"Ú†Ù„Ùˆ Ù‚ÙˆØ±Ù…Ù‡",price:160000,img:"https://i.ibb.co/LhcgTVF/ghorme.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:14,name:"Ú†Ù„Ùˆ Ù‚ÛŒÙ…Ù‡",price:160000,img:"https://i.ibb.co/LQgjQ3w/qeimeh.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:15,name:"Ú†Ù„Ùˆ ØªØ§ÙˆØ§ Ú©Ø¨Ø§Ø¨ÛŒ ØªÙ†ÙˆØ±ÛŒ",price:250000,img:"https://i.imgur.com/4x6Kf2P.jpg",cat:"ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ"},
  {id:16,name:"Ø®ÙˆØ±Ø§Ú© Ú©ÙˆØ¨ÛŒØ¯Ù‡ (Ø³ÛŒØ®ÛŒ)",price:70000,img:"https://i.imgur.com/5Z0Z1vQ.jpg",cat:"Ù¾ÛŒØ´â€ŒØºØ°Ø§"},
  {id:17,name:"Ú¯ÙˆØ¬Ù‡ Ø³ÛŒØ®ÛŒ",price:5000,img:"https://i.imgur.com/1GzZK5E.jpg",cat:"Ù¾ÛŒØ´â€ŒØºØ°Ø§"}
];

let state = {q:'',cat:'Ù‡Ù…Ù‡'};
const cats = ['Ù‡Ù…Ù‡','ØºØ°Ø§ÛŒ Ø§ØµÙ„ÛŒ','Ù¾ÛŒØ´â€ŒØºØ°Ø§','Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒ'];
const cart = {}
const t = n => n.toLocaleString('fa-IR');

function renderCats(){
  const el = document.getElementById('cats'); el.innerHTML='';
  cats.forEach(c=>{ const b = document.createElement('button'); b.textContent=c; b.className='cat'; if(c===state.cat) b.style.fontWeight='700'; b.onclick=()=>{ state.cat=c; renderList(); renderCats(); }; el.appendChild(b); })
}

function filtered(){ return foods.filter(f=> (state.cat==='Ù‡Ù…Ù‡' || f.cat===state.cat) && (!state.q || f.name.includes(state.q))); }

function renderList(){
  const grid = document.getElementById('list'); grid.innerHTML='';
  filtered().forEach(f=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `
      <img class="food-img" src="${f.img}" alt="${f.name}" />
      <div><strong>${f.name}</strong></div>
      <div class="row"><div class="small">${f.cat}</div><div class="price">${t(f.price)} ØªÙˆÙ…Ø§Ù†</div></div>
      <div class="row"><div><button class="btn" onclick="decPreview(${f.id})">âˆ’</button> <b id="q-${f.id}">0</b> <button class="btn" onclick="incPreview(${f.id})">+</button></div><button class="btn btn-add" onclick="addToCart(${f.id})">Ø§ÙØ²ÙˆØ¯Ù†</button></div>
    `;
    grid.appendChild(card);
  })
}

window.incPreview = function(id){ const el = document.getElementById("q-"+id); let cur = parseInt(el.textContent.replace(/,/g,''))||0; el.textContent = (cur+1).toLocaleString('fa-IR'); }
window.decPreview = function(id){ const el = document.getElementById("q-"+id); let cur = parseInt(el.textContent.replace(/,/g,''))||0; el.textContent = Math.max(0,cur-1).toLocaleString('fa-IR'); }

window.addToCart = function(id){ const item = foods.find(f=>f.id===id); if(!item) return; cart[id] = cart[id] || {item:item,qty:0}; cart[id].qty++; renderCart(); document.getElementById("q-"+id).textContent = cart[id].qty.toLocaleString('fa-IR'); }

function decQty(id){ if(!cart[id]) return; cart[id].qty--; if(cart[id].qty<=0) delete cart[id]; renderCart(); const qel = document.getElementById("q-"+id); if(qel) qel.textContent = (cart[id]?.qty||0).toLocaleString('fa-IR'); }
function removeFromCart(id){ if(!cart[id]) return; delete cart[id]; renderCart(); const qel = document.getElementById("q-"+id); if(qel) qel.textContent='0'; }

function renderCart(){
  const list = document.getElementById('cartList'); list.innerHTML=''; let total=0;
  Object.values(cart).forEach(ci=>{ total += ci.item.price * ci.qty; const div = document.createElement('div'); div.className='cart-item'; div.innerHTML = `<div>${ci.item.name} Ã— ${ci.qty}</div><div><button onclick="decQty(${ci.item.id})" class="btn">âˆ’</button> <button onclick="removeFromCart(${ci.item.id})" class="btn">Ø­Ø°Ù</button></div>`; list.appendChild(div); })
  document.getElementById('total').textContent = total? t(total) + ' ØªÙˆÙ…Ø§Ù†' : 'Û° ØªÙˆÙ…Ø§Ù†';
}

async function submitOrder(){
  const table = document.getElementById('table').value.trim();
  const customer = document.getElementById('customer').value.trim();
  if(!table && !customer){ alert('Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ Ù…ÛŒØ² ÛŒØ§ Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.'); return; }
  if(Object.keys(cart).length===0){ alert('Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.'); return; }
  const items = Object.values(cart).map(ci=>({id:ci.item.id,name:ci.item.name,price:ci.item.price,qty:ci.qty}));
  const total = items.reduce((s,i)=>s+i.price*i.qty,0);
  const payload = { customer: customer||null, table_number: table||null, items, total, status:'new', created_at: new Date().toISOString() };
  const { data, error } = await supabase.from('orders').insert([payload]);
  if(error){ console.error(error); alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´: ' + error.message); return; }
  alert('Ø³ÙØ§Ø±Ø´ Ø«Ø¨Øª Ø´Ø¯ âœ…');
  for(const k of Object.keys(cart)) delete cart[k]; renderCart(); document.getElementById('customer').value=''; document.getElementById('table').value='';
}

window.addEventListener('DOMContentLoaded', ()=>{ renderCats(); renderList(); renderCart(); document.getElementById('search').addEventListener('input', e=>{ state.q = e.target.value.trim(); renderList(); }); })
</script>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Ú©ØªØ±ÛŒÙ†Ú¯ Ø§ÙˆØ³ØªØ§ â€” Ú†Ù„ÙˆÚ©Ø¨Ø§Ø¨ÛŒ</h1>
        <div class="meta">Ø§Ø³Ú©Ù† QR Ø±ÙˆÛŒ Ù…ÛŒØ² â†’ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ù†Ùˆ Ùˆ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</div>
      </div>
      <div class="meta">ØªÙ…Ø§Ø³ Ù…Ø¯ÛŒØ±ÛŒØª: Û°Û¹Û±Û¹Û³Û´Û³Û´Û¸Û±Û³Û¹Û³ â€” Ù…Ø¯ÛŒØ±ÛŒØª: Ø³Ù„Ù…Ø§Ù†ÛŒ</div>
    </header>

    <div class="controls">
      <input id="search" class="search" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù…Ù†Ùˆ..." />
      <div id="cats" class="cats"></div>
    </div>

    <div class="layout">
      <main>
        <div id="list" class="grid"></div>
      </main>

      <aside class="aside">
        <label>Ø´Ù…Ø§Ø±Ù‡ Ù…ÛŒØ² ÛŒØ§ Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ (Ø§Ù„Ø²Ø§Ù…ÛŒ)</label>
        <input id="table" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ Ù…ÛŒØ² 5 ÛŒØ§ Ø§Ø³Ù… Ù…Ø´ØªØ±ÛŒ" />
        <label>ØªÙˆØ¶ÛŒØ­Ø§Øª Ø³ÙØ§Ø±Ø´ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
        <input id="customer" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ§Ø²ØŒ Ú©Ù… Ù†Ù…Ú©" />

        <h4 style="margin-top:12px">ğŸ›’ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h4>
        <div id="cartList" class="cart-list"></div>
        <div style="margin-top:10px"><strong>Ø¬Ù…Ø¹ Ú©Ù„: <span id="total">Û° ØªÙˆÙ…Ø§Ù†</span></strong></div>
        <button class="checkout" onclick="submitOrder()">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¢Ø´Ù¾Ø²Ø®Ø§Ù†Ù‡</button>
      </aside>
    </div>

    <footer class="footer">Ù†Ø³Ø®Ù‡Ù” Ú©Ø§Ù…Ù„ â€” Ù…Ø¯ÛŒØ±ÛŒØª: Ø³Ù„Ù…Ø§Ù†ÛŒ â€” Û°Û¹Û±Û¹Û³Û´Û³Û´Û¸Û±Û³Û¹Û³</footer>
  </div>
</body>
</html>
